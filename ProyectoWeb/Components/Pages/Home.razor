@page "/"
@layout LoginLayout

<RadzenCard class="rz-my-12 rz-mx-auto rz-p-4 rz-p-md-12" style="max-width: 600px;">
    <RadzenTextBox @bind-Value="userName" Name="user" Placeholder="Usuario" Style="width:100%" />
    <RadzenPassword @bind-Value="password" Name="password" Placeholder="Contraseña" Style="width:100%" class="rz-mt-2" />

    <RadzenButton Text="Iniciar sesión" Click="@Onlogin" Style="width:100%" class="rz-mt-3" />
</RadzenCard>

@code{
    CiudadanoManager CiudadanoManger;

    string userName;
    string password;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        CiudadanoManger = FabricManager.CiudadanoManager;
    }

    async void Onlogin()
    {
        // Ciudadano ciudadano = await CiudadanoManger.Login(
        // new LoginModel() { User = userName, Password = password });

        // if (ciudadano != null && ciudadano.EsAdministrador)
        // {
        //     COMMON.Params.UsuarioConectado = ciudadano.Nombre;
        //     navigationManager.NavigateTo("/catalogos/Inicio");
        // }
        // else
        // {
        //     await dialogService.Alert("Acceso restringido a administradores o credenciales inválidas.", "Error",
        //         new AlertOptions() { CloseDialogOnEsc = true });
        // }

        Ciudadano ciudadano=CiudadanoManger.Login(
            new LoginModel() { User = userName, Password = password }).Result;
        if(ciudadano != null)
        {
            COMMON.Params.UsuarioConectado = ciudadano.Nombre;
            navigationManager.NavigateTo("/catalogos/Inicio");
        }
        else
        {
            dialogService.Alert("Nombre de Usuario y/o contraseña incorrecta",
            "Erro", new AlertOptions() { CloseDialogOnEsc = true });
        }
    }

    void ButtonClicked(){
        navigationManager.NavigateTo("/catalogos/Inicio");
    }
}
